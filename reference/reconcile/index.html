
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Python utilities to reconcile Pandas DataFrames." name="description"/>
<link href="https://jvfe.github.io/reconciler/reference/reconcile/" rel="canonical"/>
<meta content="jvfe" name="author"/>
<link href="../../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-5.5.11" name="generator"/>
<title>Main module - reconciler</title>
<link href="../../assets/stylesheets/main.860688db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#reconcilerreconcile">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="reconciler" class="md-header-nav__button md-logo" href="https://jvfe.github.io/reconciler/" title="reconciler">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<span class="md-header-nav__topic md-ellipsis">
            reconciler
          </span>
<span class="md-header-nav__topic md-ellipsis">
            
              Main module
            
          </span>
</div>
</div>
<label class="md-header-nav__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/jvfe/reconciler/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="reconciler" class="md-nav__button md-logo" href="https://jvfe.github.io/reconciler/" title="reconciler">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
    reconciler
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/jvfe/reconciler/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../.." title="Home">
      Home
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../installing/" title="Installation">
      Installation
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../history/" title="Version history">
      Version history
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" id="nav-4" type="checkbox"/>
<label class="md-nav__link" for="nav-4">
      Contributing
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Contributing" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-4">
<span class="md-nav__icon md-icon"></span>
        Contributing
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../contributing/" title="Contribution guide">
      Contribution guide
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../authors/" title="Contributors">
      Contributors
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" id="nav-5" type="checkbox"/>
<label class="md-nav__link" for="nav-5">
      Example usage
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Example usage" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-5">
<span class="md-nav__icon md-icon"></span>
        Example usage
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../examples/reconcile_cell_types/" title="Reconciling cell types">
      Reconciling cell types
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-6" id="nav-6" type="checkbox"/>
<label class="md-nav__link" for="nav-6">
      Reference
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-6">
<span class="md-nav__icon md-icon"></span>
        Reference
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Main module
        <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./" title="Main module">
      Main module
    </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#reconciler.reconcile.reconcile">
    reconciler.reconcile.reconcile
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../webutils/" title="Utility module">
      Utility module
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#reconciler.reconcile.reconcile">
    reconciler.reconcile.reconcile
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/jvfe/reconciler/edit/master/docs/reference/reconcile.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="reconcilerreconcile">reconciler.reconcile</h1>
<p>The main module, containing the functions intended for end-users.</p>
<p><strong>reconcile()</strong></p>
<div class="doc doc-object doc-function">
<h2 class="hidden-toc" href="#reconciler.reconcile.reconcile" id="reconciler.reconcile.reconcile" style="visibility: hidden; width: 0; height: 0;">
</h2>
<div class="doc doc-contents first">
<p>Reconcile a DataFrame column</p>
<p>This is the main function of this package, it takes in a Pandas Series,
that is, a column of a DataFrame, and sends it for reconciliation. In
order to return more confident results, the parameter type_id corresponds
to the type of item you're trying to reconcile against, that is, in case of a Wikidata item,
it is the item's 'instance of' property. There is also a top_res argument,
to filter the retrieved matches, this can be either an int, corresponding to the number of
matches you want to retrieve for each reconciled item, or 'all', to return all matches.
The reconciliation_endpoint argument corresponds to the reconciliation service you're
trying to access, if no value is given, it will default to the Wikidata reconciliation
endpoint. See <a href="https://reconciliation-api.github.io/testbench/">https://reconciliation-api.github.io/testbench/</a> for a list of available
endpoints.</p>
<p>The time this function takes to run will depend on the number of unique items
you have on your column, keep in mind that if you have a very large DataFrame, it
may be easier to break it up in smaller pieces and reconcile each one individually.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>column_to_reconcile</code></td>
<td><code>Series</code></td>
<td>
<p>A pandas Series corresponding to
the column to be reconciled.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>type_id</code></td>
<td><code>str</code></td>
<td>
<p>The item type to reconcile against, in case of a
wikidata item, it corresponds to the item's 'instance of' QID.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>top_res</code></td>
<td><code>int or str</code></td>
<td>
<p>The maximum number of matches to return for
each reconciled item, defaults to one. To retrieve all matches,
set it to 'all'.</p>
</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>reconciliation_endpoint</code></td>
<td><code>str</code></td>
<td>
<p>The reconciliation endpoint, defaults
to the Wikidata reconciliation endpoint.</p>
</td>
<td><code>'https://wikidata.reconci.link/en/api'</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DataFrame</code></td>
<td>
<p>A Pandas DataFrame with the reconciled results.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValueError</code></td>
<td>
<p>top_res argument must be one of either 'all' or an integer.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>reconciler/reconcile.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">reconcile</span><span class="p">(</span>
    <span class="n">column_to_reconcile</span><span class="p">,</span>
    <span class="n">type_id</span><span class="p">,</span>
    <span class="n">top_res</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">reconciliation_endpoint</span><span class="o">=</span><span class="s2">"https://wikidata.reconci.link/en/api"</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Reconcile a DataFrame column</span>

<span class="sd">    This is the main function of this package, it takes in a Pandas Series,</span>
<span class="sd">    that is, a column of a DataFrame, and sends it for reconciliation. In</span>
<span class="sd">    order to return more confident results, the parameter type_id corresponds</span>
<span class="sd">    to the type of item you're trying to reconcile against, that is, in case of a Wikidata item,</span>
<span class="sd">    it is the item's 'instance of' property. There is also a top_res argument,</span>
<span class="sd">    to filter the retrieved matches, this can be either an int, corresponding to the number of</span>
<span class="sd">    matches you want to retrieve for each reconciled item, or 'all', to return all matches.</span>
<span class="sd">    The reconciliation_endpoint argument corresponds to the reconciliation service you're</span>
<span class="sd">    trying to access, if no value is given, it will default to the Wikidata reconciliation</span>
<span class="sd">    endpoint. See &lt;https://reconciliation-api.github.io/testbench/&gt; for a list of available</span>
<span class="sd">    endpoints.</span>

<span class="sd">    The time this function takes to run will depend on the number of unique items</span>
<span class="sd">    you have on your column, keep in mind that if you have a very large DataFrame, it</span>
<span class="sd">    may be easier to break it up in smaller pieces and reconcile each one individually.</span>

<span class="sd">    Args:</span>
<span class="sd">        column_to_reconcile (Series): A pandas Series corresponding to</span>
<span class="sd">            the column to be reconciled.</span>
<span class="sd">        type_id (str): The item type to reconcile against, in case of a</span>
<span class="sd">            wikidata item, it corresponds to the item's 'instance of' QID.</span>
<span class="sd">        top_res (int or str): The maximum number of matches to return for</span>
<span class="sd">            each reconciled item, defaults to one. To retrieve all matches,</span>
<span class="sd">            set it to 'all'.</span>
<span class="sd">        reconciliation_endpoint (str): The reconciliation endpoint, defaults</span>
<span class="sd">            to the Wikidata reconciliation endpoint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A Pandas DataFrame with the reconciled results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: top_res argument must be one of either 'all' or an integer.</span>
<span class="sd">    """</span>
    <span class="n">input_keys</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">return_reconciled_raw</span><span class="p">(</span>
        <span class="n">column_to_reconcile</span><span class="p">,</span> <span class="n">type_id</span><span class="p">,</span> <span class="n">reconciliation_endpoint</span>
    <span class="p">)</span>

    <span class="n">parsed</span> <span class="o">=</span> <span class="n">parse_raw_results</span><span class="p">(</span><span class="n">input_keys</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

    <span class="n">full_df</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"features"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">top_res</span> <span class="o">==</span> <span class="s2">"all"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">full_df</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_res</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="n">full_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"input_value"</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_res</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filtered</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"top_res argument must be one of either 'all' or an integer"</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--prev" href="../../examples/reconcile_cell_types/" rel="prev" title="Reconciling cell types">
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Reconciling cell types
              </div>
</div>
</a>
<a class="md-footer-nav__link md-footer-nav__link--next" href="../webutils/" rel="next" title="Utility module">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Utility module
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<script src="../../assets/javascripts/vendor.df0def68.min.js"></script>
<script src="../../assets/javascripts/bundle.ba57d267.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
<script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
</body>
</html>